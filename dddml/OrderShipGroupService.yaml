#%DDDML 0.1

---

# ------------------------------
services:

  # ---------------------------------------
  # 订单装运组服务（入库出库通知）
  OrderShipGroupService:
  
    # ------------------------------
    valueObjects:
    
      # -------------------------------------
      # 订单行项与装运组的关联信息
      OrderItemShipGroupAssociationInfo:
        properties:
          # 订单 Id（合同号）
          OrderId:
            type: id
          #---------------------------------
          # 订单装运组序号（通知单号）
          ShipGroupSeqId:
            type: id
          # -------------------------------------------------
          # 订单（行）项序号
          # （为空则创建新行项，否则检查、更新已有行项）
          OrderItemSeqId:
            type: id
          # 产品 Id
          ProductId:
            type: id-long
          # 数量（以产品主计量单位计算）
          Quantity:
            type: fixed-point
          # -------------------------------------------------
          # 件数（包裹数量）
          NumberOfPackages:
            type: int
          # 柜数（集装箱数量）
          NumberOfContainers:
            type: int
          # 每集装箱件数
          NumberOfPakagesPerContainer:
            type: int
            
      # -------------------------------------
      # 订单 Id 与装运组序号 Pair
      OrderIdShipGroupSeqIdPair:
        properties:
          # 订单 Id（合同号）
          OrderId:
            type: id
          #---------------------------------
          # 订单装运组序号（通知单号）
          ShipGroupSeqId:
            type: id
          
    
    # ------------------------------------
    # 方法
    methods:
      
      # ------------------------------------
      # 创建装运组（入库通知单）
      CreatePOShipGroups:
        #authorizationEnabled: true
        #requiredAnyRole: ["ADMIN", "WarehouseOP"]
        
        parameters:
          # ------------------------------
          # 预计交付时间（入库时间）
          EstimatedDeliveryDate:
            type: date-time
          # ------------------------------
          # 联系人
          ContactPartyId:
            type: string
            referenceType: Party
          # 联系电话
          TelecomContactMechId:
            type: id
          # 追踪（物流）单号
          TrackingNumber:
            type: short-varchar
          # -----------------------------
          ## 源仓库 / 设施 Id
          #FacilityId:
          #  type: id
          # 目标仓库 / 设施 Id
          DestinationFacilityId:
            type: id
          # -----------------------------
          OrderItemShipGroupAssociations:
            itemType: OrderItemShipGroupAssociationInfo
            
      # ------------------------------------
      # 创建装运组（出库通知单）
      CreateSOShipGroups:
      
        parameters:
          # ------------------------------
          # 预计发货日期（出库时间）
          EstimatedShipDate:
            type: date-time
          # ------------------------------
          # 司机 / 联系人
          ContactPartyId:
            type: string
            referenceType: Party
          # 司机 / 联系人电话
          TelecomContactMechId:
            type: id
          # 追踪（物流）单号
          TrackingNumber:
            type: short-varchar
          # ------------------------------
          # 车牌号
          VehiclePlateNumber:
            type: long-varchar
          # 发货指示 / 客户名称 / 备注等  
          ShippingInstructions:
            type: long-varchar
          # -----------------------------
          # 源仓库 / 设施 Id
          FacilityId:
            type: id
          ## 目标仓库 / 设施 Id
          #DestinationFacilityId:
          #  type: id
          # ------------------------------
          OrderItemShipGroupAssociations:
            itemType: OrderItemShipGroupAssociationInfo
      
      # ----------------------------------------------------
      # 更新订单项目与装运组的关联信息
      UpdateOrderItemShipGroupAssociation:
        parameters:
        
          OrderItemShipGroupAssociation:
            type: OrderItemShipGroupAssociationInfo
            
        
      # ---------------------------------------
      # 从装运组（入库通知单）创建装运单
      CreatePOShipment:
      
        parameters:
        
          # 一个装运单可以发多个装运组的货
          OrderIdShipGroupSeqIdPairs:
            itemType: OrderIdShipGroupSeqIdPair
            
          # 装运单 Id，可以为空
          ShipmentId:
            type: id
          OriginFacilityId:
            type: id
          DestinationFacilityId:
            type: id
          # 是否置为“已发运”状态
          IsShipped:
            type: bool
        
        # 返回结果，装运单 Id
        result:
          type: string
            
      # ---------------------------------------
      # 从装运组（出库通知单）创建装运单
      CreateSOShipment:
      
        parameters:
        
          # 一个装运单可以发多个装运组的货
          OrderIdShipGroupSeqIdPairs:
            itemType: OrderIdShipGroupSeqIdPair
            
          # 装运单 Id，可以为空
          ShipmentId:
            type: id
          OriginFacilityId:
            type: id
          DestinationFacilityId:
            type: id
        
        # 返回结果，装运单 Id
        result:
          type: string
        
      # ---------------------------------------
      # 发出一个 PO 装运单（状态转换为“已发出”）
      ShipPOShipment:
      
        parameters:
          # 装运单 Id
          ShipmentId:
            type: id-ne
          # ------------------------
          # 关联的主订单 Id
          PrimaryOrderId:
            type: id
          # 关联的主订单装运组序号
          PrimaryShipGroupSeqId:
            type: id
          # ------------------------------------------------
          # 是否自动生成（订单装运组中存在的产品的）装运项
          HintShipmentItemsEnabled:
            type: bool
          # 主订单/装运组之外的其他订单装运组 Id Pair
          OtherOrderIdShipGroupSeqIdPairs:
            itemType: OrderIdShipGroupSeqIdPair
          OriginFacilityId:
            type: id
          DestinationFacilityId:
            type: id
        
        
        
        
        
        
        
        
        
            